<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç–«è‹—é ç´„</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f2f7f5;
      padding: 16px;
    }
    .card {
      max-width: 420px;
      margin: auto;
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }
    h2 {
      text-align: center;
      margin-bottom: 16px;
    }
    label {
      font-size: 14px;
      margin-top: 12px;
      display: block;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }
    button {
      margin-top: 20px;
      background: #5cbdb9;
      color: white;
      border: none;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>ç–«è‹—é ç´„</h2>

    <label>é ç´„æ—¥æœŸ</label>
    <input type="date" id="date"/>

    <label>é ç´„æ™‚æ®µ</label>
    <select id="time">
      <option value="">è«‹å…ˆé¸æ—¥æœŸ</option>
    </select>

    <label>ç–«è‹—é …ç›®</label>
    <input id="vaccine"/>

    <label>å§“å</label>
    <input id="name"/>

    <label>é›»è©±</label>
    <input id="phone"/>

    <label>èº«åˆ†è­‰</label>
    <input id="idCard"/>

    <label>å‡ºç”Ÿæ—¥æœŸ</label>
    <input type="date" id="birthday"/>

    <button onclick="submitForm()">é€å‡ºé ç´„</button>
  </div>

<script>
const GAS_URL = "https://techang0911.github.io/vaccine-booking/";
const LIFF_ID = "2008795875-tZfdoVwR";
let lineId = "";

liff.init({ liffId: LIFF_ID }).then(() => {

  // âœ… åªæœ‰åœ¨ LINE è£¡ï¼Œæ‰è™•ç†ç™»å…¥
  if (liff.isInClient()) {
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }
    return liff.getProfile();
  } else {
    // ğŸ‘‰ ä¸€èˆ¬ç€è¦½å™¨æ¨¡å¼ï¼ˆæ¸¬è©¦ç”¨ï¼‰
    console.log("é LINE ç’°å¢ƒï¼Œè·³é LIFF ç™»å…¥");
  }

}).then(profile => {
  if (profile) {
    lineId = profile.userId;
  }
});


document.getElementById("date").addEventListener("change", loadSlots);

function loadSlots() {
  const select = document.getElementById("time");
  select.innerHTML = "";
  ["09:00â€“09:30","09:30â€“10:00","10:00â€“10:30",
   "15:30â€“16:00","16:30â€“17:00",
   "19:30â€“20:00","20:00â€“20:30"
  ].forEach(t => {
    const opt = document.createElement("option");
    opt.value = t;
    opt.textContent = t;
    select.appendChild(opt);
  });
}

function submitForm() {
  const data = {
    date: date.value,
    time: time.value,
    vaccine: vaccine.value,
    name: name.value,
    phone: phone.value,
    idCard: idCard.value,
    birthday: birthday.value,
    lineId: lineId
  };

  Swal.showLoading();
  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(r => r.json())
  .then(res => {
    if (res.status === "success") {
      Swal.fire("é ç´„æˆåŠŸ");
      liff.closeWindow();
    } else {
      Swal.fire(res.message || "å¤±æ•—");
    }
  });
}
</script>
</body>
</html>
